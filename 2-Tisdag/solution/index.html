<!DOCTYPE html>
<html>
  <head>
    <title>Redux M친ndag</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.1.2/redux.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux-thunk/2.4.1/redux-thunk.min.js"></script>
  </head>
  <body>
    <div>
        <button onclick="store.dispatch(getSauce())">Get secret sauce 游뱖</button>
        I dare you, click the button. The sauce is: <span id="sauce">...</span>
    </div>
    <script>
    // Funktionen som h칛mtar data fr친n v친r endpoint
    const getSauceFromUrl = async () => {
        return fetch('https://6257f4fa0c918296a48e7812.mockapi.io/secret_sauce').then(response => response.json()).then(data => data.sauce)
    }

    let { createStore, applyMiddleware } = Redux;
    let thunk = ReduxThunk;

    // V친r reducer d칛r vi definerar olika utfall (endast 1 i detta fall) och vad som ska h칛nda h칛danefter.
     const sauceReducer = (state = '...', action) => {
       switch (action.type) {
         case 'GET_SAUCE':
           return action.payload
         default:
           return state
       }
    }

    // Vi skapar v친ran store och skickar med v친r reducer, vi l칛gger 칛ven till thunk som middleware
    let store = createStore(sauceReducer, applyMiddleware(thunk))
    
    // Vi sparar #sauce elementet i en variabel f칬r att senare kunna anv칛nda den
    let sauceEl = document.getElementById('sauce')

    // Vi definerar en funktion som ska k칬ras varje g친ng store uppdateras
    function render() {
        sauceEl.innerHTML = store.getState()
    }

    // V친r render funktion k칬rs vid start av hemsidan
    render()

    // Vi kopplar v친r render funktion s친 att den lyssnar p친 칛ndringar i v친r store och k칬r render funktionen
    store.subscribe(render)

    // V친r redux action som ber oss h칛mta data fr친n v친r endpoint
    const getSauce = () => {
        return (dispatch) => {
            getSauceFromUrl().then(sauce => {
                dispatch({
                    type: 'GET_SAUCE',
                    payload: sauce
                })
            })
        }
    }
    </script>
  </body>
</html>
